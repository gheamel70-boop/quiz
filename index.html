<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC Quiz Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #2a1025;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: linear-gradient(135deg, #D5BF86 0%, #F0F0CE 100%);
            border: 8px solid #7B532F;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 600px;
            position: relative;
        }

        /* HEADER */
        .header {
            background: linear-gradient(90deg, #7B532F 0%, #8B6332 100%);
            padding: 15px 20px;
            border-radius: 7px 7px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display:flex ;
            align-items: center;
            gap :10px ;
            color :#F0F0CE ;
            font-size : 18px ;
            font-weight: bold;
        }
        
        .logo-img {
             width: 30px;          /* taille du logo */
            height: 30px;
            object-fit: contain;
            border-radius: 6px;
            background: linear-gradient(90deg, #7B532F, #8B6332);
            padding: 3px;
}


        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #F0F0CE;
            color: #7B532F;
            border: 2px solid #7B532F;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }

        .nav-btn:hover {
            background: #7B532F;
            color: #F0F0CE;
        }

        /* CONTENT */
        .content {
            padding: 30px;
        }

        .info-box {
            background: linear-gradient(135deg, #B6761C 0%, #8B6332 100%);
            color: #F0F0CE;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 25px;
            font-size: 15px;
            line-height: 1.6;
            border: 3px solid #7B532F;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* WELCOME SCREEN */
        .input-box {
            background: linear-gradient(135deg, #B6761C 0%, #8B6332 100%);
            border: 3px solid #7B532F;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #F0F0CE;
        }

        .input-label {
            color: #F0F0CE;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 100%;
            max-width: 350px;
            padding: 12px;
            border: 2px solid #7B532F;
            border-radius: 5px;
            font-size: 15px;
            background: white;
            color: #180312;
            margin-bottom: 20px;
            text-align: center;
        }

        input[type="text"]::placeholder {
            color: #999;
        }

        .btn {
            background: #180312;
            color: #F0F0CE;
            border: 2px solid #180312;
            padding: 12px 40px;
            border-radius: 5px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            background: #7B532F;
            border-color: #7B532F;
            transform: scale(1.05);
        }

        .btn::after {
            content: 'â†’';
            font-size: 18px;
        }

        /* QUIZ SCREEN */
        .question-container {
            margin-bottom: 20px;
        }

        .question-header {
            color: #7B532F;
            font-size: 13px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }

        .language-badge {
            display: inline-block;
            background: #180312;
            color: #F0F0CE;
            padding: 6px 18px;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            width: 100%;
        }

        .question-text {
            background: linear-gradient(135deg, #B6761C 0%, #8B6332 100%);
            color: #F0F0CE;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #7B532F;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.5;
            font-weight: 500;
        }

        .answer-option {
            background: white;
            border: 2px solid #B6761C;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #180312;
            font-size: 15px;
            font-weight: 500;
        }

        .answer-option:hover {
            background: #F0F0CE;
            border-color: #7B532F;
            transform: translateX(5px);
        }

        .answer-option.selected {
            background: #B6761C;
            color: white;
            border-color: #180312;
        }

        .answer-option.correct {
            background: #4CAF50;
            color: white;
            border-color: #2E7D32;
        }

        .answer-option.wrong {
            background: #f44336;
            color: white;
            border-color: #c62828;
        }

        .next-btn-container {
            text-align: center;
            margin-top: 20px;
        }

        /* RESULTS SCREEN */
        .score-display {
            text-align: center;
            padding: 20px 0;
        }

        .score-box {
            background: linear-gradient(135deg, #B6761C 0%, #8B6332 100%);
            border: 3px solid #7B532F;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            color: #F0F0CE;
        }

        .score-box > div:first-child {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .score-number {
            font-size: 3em;
            color: #F0F0CE;
            font-weight: bold;
            margin: 20px 0;
        }

        /* LEADERBOARD */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: #8B6332;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #7B532F;
        }

        .leaderboard-table th {
            background: #180312;
            color: #F0F0CE;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 13px;
        }

        .leaderboard-table td {
            padding: 12px 10px;
            color: #F0F0CE;
            border-bottom: 1px solid #B6761C;
            font-size: 14px;
        }

        .leaderboard-table tr:nth-child(even) {
            background: rgba(182, 118, 28, 0.2);
        }

        .leaderboard-table tr:hover {
            background: rgba(213, 191, 134, 0.2);
        }

        .rank {
            font-weight: bold;
            color: #F0F0CE;
        }

        .arabic {
            direction: rtl;
            text-align: right;
        }

        /* FOOTER */
        /* FOOTER */
.footer {
    background: linear-gradient(90deg, #2a1025 0%, #3d1a32 100%);
    padding: 0;
    margin-top: auto;
}

.footer-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 30px 60px;
    max-width: 1200px;
    margin: 0 auto;
}

.footer-logo {
    display: flex;
    align-items: center;
    gap: 15px;
}

.footer-logo img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    filter: brightness(1.1);
}

.footer-logo-text {
    font-size: 14px;
    font-weight: bold;
    letter-spacing: 2px;
    color: #F0F0CE;
    line-height: 1.4;
}

.footer-divider {
    width: 1px;
    height: 80px;
    background: linear-gradient(180deg, transparent, rgba(240, 240, 206, 0.3), transparent);
}

.footer-nav {
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: flex-start;
}

.footer-link {
    color: #F0F0CE;
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 1.5px;
    transition: all 0.3s;
    padding: 5px 0;
}

.footer-link:hover {
    color: #D5BF86;
    padding-left: 10px;
}

/* RESPONSIVE FOOTER */
@media (max-width: 600px) {
    .footer-container {
        flex-direction: column;
        gap: 20px;
        padding: 25px 20px;
        text-align: center;
    }
    
    .footer-logo {
        flex-direction: column;
        gap: 10px;
    }
    
    .footer-divider {
        width: 80%;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(240, 240, 206, 0.3), transparent);
    }
    
    .footer-nav {
        align-items: center;
    }
    
    .footer-link:hover {
        padding-left: 0;
    }
}

        /* RESPONSIVE */
        @media (max-width: 600px) {
            .container {
                border-width: 4px;
            }

            .header {
                padding: 12px 15px;
                justify-content: center;
            }

            .logo {
                font-size: 16px;
                width: 100%;
                justify-content: center;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
            }

            .nav-btn {
                font-size: 10px;
                padding: 6px 12px;
            }

            .content {
                padding: 20px;
            }

            .info-box {
                font-size: 14px;
                padding: 15px;
            }

            .input-box {
                padding: 20px;
            }

            .input-label {
                font-size: 16px;
            }

            .question-text {
                font-size: 15px;
                padding: 15px;
            }

            .answer-option {
                font-size: 14px;
                padding: 12px;
            }

            .score-number {
                font-size: 2.5em;
            }

            .leaderboard-table th,
            .leaderboard-table td {
                padding: 10px 8px;
                font-size: 12px;
            }

            .footer {
                padding: 20px;
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .footer-divider {
                display: none;
            }
        }

        @media (max-width: 400px) {
            .main-container {
                padding: 10px;
            }

            .content {
                padding: 15px;
            }

            .btn {
                padding: 10px 30px;
                font-size: 14px;
            }

            .score-number {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="container">
            <div class="header">
               <div class="logo">
                  <img src="logo.png" alt="Logo ESC" class="logo-img">
                    <span>ESC Quiz Platform</span>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="resetQuiz()">PLAY</button>
                    <button class="nav-btn" onclick="showLeaderboard()">LEADERBOARD</button>
                    <button class="nav-btn">OUR WEBSITE</button>
                </div>
            </div>

            <div class="content">
                <!-- Ã‰cran d'accueil -->
                <div id="welcome-screen" class="screen active">
                    <div class="info-box">
                        Answer the questions, earn points, and see your final score and ranking.
                    </div>
                    <div class="input-box">
                        <div class="input-label">First, Let us know your name!</div>
                        <input type="text" id="participant-name" placeholder="Enter your name here">
                        <button class="btn" onclick="startQuiz()">START</button>
                    </div>
                </div>

                <!-- Ã‰cran du quiz -->
                <div id="quiz-screen" class="screen">
                    <div class="info-box" id="quiz-info"></div>
                    <div class="question-container">
                        <div class="question-header" id="question-number"></div>
                        <div class="language-badge" id="language-badge"></div>
                        <div class="question-text" id="question-text"></div>
                        <div id="answers-container"></div>
                    </div>
                    <div class="next-btn-container">
                        <button class="btn" id="confirm-btn" onclick="confirmAnswer()">Confirm</button>
                        <button class="btn" id="next-btn" onclick="nextQuestion()" style="display:none">NEXT</button>
                    </div>
                </div>

                <!-- Ã‰cran des rÃ©sultats -->
                <div id="results-screen" class="screen">
                    <div class="info-box">
                        Done all questions, your total score in answering the questions is:
                    </div>
                    <div class="score-display">
                        <div class="score-box">
                            <div>Good Job! Your final score is:</div>
                            <div class="score-number" id="final-score"></div>
                        </div>
                        <button class="btn" onclick="showLeaderboard()">View Leaderboard</button>
                    </div>
                </div>

                <!-- Ã‰cran du classement -->
                <div id="leaderboard-screen" class="screen">
                    <div class="info-box">
                        Final leaderboard of all participants
                    </div>
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Accuracy</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body"></tbody>
                    </table>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="resetQuiz()">Try Again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Footer -->
<!-- Footer -->
<div class="footer">
    <div class="footer-container">
        <div class="footer-logo">
            <img src="logo1.png" alt="Logo Epstimi Signum">
            <div class="footer-logo-text">EPSTIMI<br>SIGNUM</div>
        </div>
        <div class="footer-divider"></div>
        <div class="footer-nav">
            <a href="#" class="footer-link">HOME</a>
            <a href="#" class="footer-link">ABOUT</a>
            <a href="#" class="footer-link">LEADERS</a>
        </div>
    </div>
</div>



    <script>
        // GRANDE BANQUE DE QUESTIONS (40+ questions)
        const allQuestions = [
            // FranÃ§ais
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Quelle est la vitesse de la lumiÃ¨re dans le vide ?",
                answers: ["300 000 km/s", "150 000 km/s", "450 000 km/s", "600 000 km/s"],
                correct: 0
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Combien de chromosomes possÃ¨de l'Ãªtre humain ?",
                answers: ["23", "46", "48", "52"],
                correct: 1
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Qui a dÃ©couvert la radioactivitÃ© ?",
                answers: ["Marie Curie", "Albert Einstein", "Isaac Newton", "GalilÃ©e"],
                correct: 0
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Quel est le plus grand ocÃ©an du monde ?",
                answers: ["Atlantique", "Indien", "Pacifique", "Arctique"],
                correct: 2
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Quelle est la capitale de l'Australie ?",
                answers: ["Sydney", "Melbourne", "Canberra", "Brisbane"],
                correct: 2
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Combien y a-t-il de continents sur Terre ?",
                answers: ["5", "6", "7", "8"],
                correct: 2
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Quel gaz les plantes absorbent-elles ?",
                answers: ["OxygÃ¨ne", "Azote", "CO2", "HydrogÃ¨ne"],
                correct: 2
            },
            {
                language: "FranÃ§ais",
                langCode: "fr",
                question: "Quelle est la langue la plus parlÃ©e au monde ?",
                answers: ["Anglais", "Mandarin", "Espagnol", "Hindi"],
                correct: 1
            },
            
            // English
            {
                language: "English",
                langCode: "en",
                question: "Who developed the theory of relativity?",
                answers: ["Isaac Newton", "Albert Einstein", "Galileo", "Stephen Hawking"],
                correct: 1
            },
            {
                language: "English",
                langCode: "en",
                question: "What is the unit of measurement for force?",
                answers: ["Joule", "Watt", "Newton", "Pascal"],
                correct: 2
            },
            {
                language: "English",
                langCode: "en",
                question: "What is the largest organ in the human body?",
                answers: ["Heart", "Brain", "Skin", "Liver"],
                correct: 2
            },
            {
                language: "English",
                langCode: "en",
                question: "How many bones are in the adult human body?",
                answers: ["186", "206", "226", "246"],
                correct: 1
            },
            {
                language: "English",
                langCode: "en",
                question: "What is the smallest country in the world?",
                answers: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"],
                correct: 1
            },
            {
                language: "English",
                langCode: "en",
                question: "Who painted the Mona Lisa?",
                answers: ["Michelangelo", "Leonardo da Vinci", "Raphael", "Donatello"],
                correct: 1
            },
            {
                language: "English",
                langCode: "en",
                question: "What is the hardest natural substance?",
                answers: ["Gold", "Iron", "Diamond", "Platinum"],
                correct: 2
            },
            {
                language: "English",
                langCode: "en",
                question: "In which year did World War II end?",
                answers: ["1943", "1944", "1945", "1946"],
                correct: 2
            },
            
            // EspaÃ±ol
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿CuÃ¡ntos planetas hay en nuestro sistema solar?",
                answers: ["7", "8", "9", "10"],
                correct: 1
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿QuÃ© planeta estÃ¡ mÃ¡s cerca del Sol?",
                answers: ["Venus", "Marte", "Mercurio", "Tierra"],
                correct: 2
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿CuÃ¡l es el rÃ­o mÃ¡s largo del mundo?",
                answers: ["Nilo", "Amazonas", "YangtsÃ©", "Misisipi"],
                correct: 1
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿CuÃ¡ntos lados tiene un hexÃ¡gono?",
                answers: ["4", "5", "6", "7"],
                correct: 2
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿QuÃ© animal es el mÃ¡s rÃ¡pido del mundo?",
                answers: ["LeÃ³n", "Guepardo", "Tigre", "Leopardo"],
                correct: 1
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿En quÃ© continente estÃ¡ Egipto?",
                answers: ["Asia", "Europa", "Ãfrica", "AmÃ©rica"],
                correct: 2
            },
            {
                language: "EspaÃ±ol",
                langCode: "es",
                question: "Â¿CuÃ¡l es el metal mÃ¡s abundante en la Tierra?",
                answers: ["Hierro", "Aluminio", "Cobre", "Oro"],
                correct: 1
            },
            
            // Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ Ù„Ù„Ø°Ù‡Ø¨ØŸ",
                answers: ["Au", "Ag", "Fe", "Cu"],
                correct: 0
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "Ù…Ù† Ø§Ø®ØªØ±Ø¹ Ø§Ù„Ø¨Ù†Ø³Ù„ÙŠÙ†ØŸ",
                answers: ["Ù„ÙˆÙŠØ³ Ø¨Ø§Ø³ØªÙˆØ±", "Ø£Ù„ÙƒØ³Ù†Ø¯Ø± ÙÙ„ÙŠÙ…Ù†Øº", "Ù…Ø§Ø±ÙŠ ÙƒÙˆØ±ÙŠ", "Ø±ÙˆØ¨Ø±Øª ÙƒÙˆØ®"],
                correct: 1
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ù†Ø©ØŸ",
                answers: ["360", "364", "365", "366"],
                correct: 2
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ",
                answers: ["Ù„Ù†Ø¯Ù†", "Ø¨Ø±Ù„ÙŠÙ†", "Ø¨Ø§Ø±ÙŠØ³", "Ø±ÙˆÙ…Ø§"],
                correct: 2
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
                answers: ["5", "6", "7", "8"],
                correct: 2
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ",
                answers: ["Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø²Ø­Ù„", "Ù†Ø¨ØªÙˆÙ†", "Ø£ÙˆØ±Ø§Ù†ÙˆØ³"],
                correct: 0
            },
            {
                language: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                langCode: "ar",
                question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŸ",
                answers: ["5", "6", "7", "8"],
                correct: 2
            },
            
            // Deutsch (German)
            {
                language: "Deutsch",
                langCode: "de",
                question: "Was ist die chemische Formel fÃ¼r Wasser?",
                answers: ["H2O", "CO2", "O2", "H2O2"],
                correct: 0
            },
            {
                language: "Deutsch",
                langCode: "de",
                question: "Was ist der Siedepunkt von Wasser auf MeereshÃ¶he?",
                answers: ["90Â°C", "100Â°C", "110Â°C", "120Â°C"],
                correct: 1
            },
            {
                language: "Deutsch",
                langCode: "de",
                question: "Wie viele BundeslÃ¤nder hat Deutschland?",
                answers: ["14", "15", "16", "17"],
                correct: 2
            },
            {
                language: "Deutsch",
                langCode: "de",
                question: "Wer schrieb 'Faust'?",
                answers: ["Schiller", "Goethe", "Heine", "Kafka"],
                correct: 1
            },
            {
                language: "Deutsch",
                langCode: "de",
                question: "Was ist die Hauptstadt von Spanien?",
                answers: ["Barcelona", "Madrid", "Valencia", "Sevilla"],
                correct: 1
            },
            {
                language: "Deutsch",
                langCode: "de",
                question: "Wie viele Sekunden hat eine Stunde?",
                answers: ["3000", "3600", "4200", "3300"],
                correct: 1
            },
            
            // Italiano (Italian)
            {
                language: "Italiano",
                langCode: "it",
                question: "Qual Ã¨ la capitale dell'Italia?",
                answers: ["Milano", "Napoli", "Roma", "Firenze"],
                correct: 2
            },
            {
                language: "Italiano",
                langCode: "it",
                question: "Quanti giorni ci sono in febbraio (anno non bisestile)?",
                answers: ["27", "28", "29", "30"],
                correct: 1
            },
            {
                language: "Italiano",
                langCode: "it",
                question: "Chi ha dipinto la Cappella Sistina?",
                answers: ["Leonardo", "Michelangelo", "Raffaello", "Donatello"],
                correct: 1
            }
        ];

        // Variables globales
        let questions = [];
        let currentQuestion = 0;
        let score = 0;
        let participantName = '';
        let userAnswers = [];
        let answered = false;
        let localScores = [];

        // Fonction pour mÃ©langer un tableau
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Fonction pour mÃ©langer les rÃ©ponses
        function shuffleAnswers(question) {
            const indices = [0, 1, 2, 3];
            const shuffledIndices = shuffleArray(indices);
            
            return {
                ...question,
                answers: shuffledIndices.map(i => question.answers[i]),
                correct: shuffledIndices.indexOf(question.correct)
            };
        }

        function startQuiz() {
            participantName = document.getElementById('participant-name').value.trim();
            if (!participantName) {
                alert('Please enter your name!');
                return;
            }
            
            const shuffledAll = shuffleArray(allQuestions);
            const selectedQuestions = shuffledAll.slice(0, 15);
            questions = selectedQuestions.map(q => shuffleAnswers(q));
            
            questions = questions.map(q => ({
                ...q,
                answers: q.answers.map((ans, i) => 
                    `${String.fromCharCode(65 + i)}) ${ans}`
                )
            }));
            
            showScreen('quiz-screen');
            loadQuestion();
        }

        function loadQuestion() {
            answered = false;
            const question = questions[currentQuestion];
            const questionText = document.getElementById('question-text');
            
            document.getElementById('question-number').textContent = 
                `Question ${currentQuestion + 1} of ${questions.length}`;
            
            document.getElementById('language-badge').textContent = question.language;
            
            if (question.langCode === 'ar') {
                questionText.classList.add('arabic');
            } else {
                questionText.classList.remove('arabic');
            }
            
            questionText.textContent = question.question;
            
            const answersContainer = document.getElementById('answers-container');
            answersContainer.innerHTML = '';
            
            if (question.langCode === 'ar') {
                answersContainer.classList.add('arabic');
            } else {
                answersContainer.classList.remove('arabic');
            }
            
            question.answers.forEach((answer, index) => {
                const div = document.createElement('div');
                div.className = 'answer-option';
                div.textContent = answer;
                div.onclick = () => selectAnswer(index);
                answersContainer.appendChild(div);
            });
            
            document.getElementById('confirm-btn').style.display = 'inline-flex';
            document.getElementById('next-btn').style.display = 'none';
            
            updateQuizInfo();
        }

        function updateQuizInfo() {
            const question = questions[currentQuestion];
            const infoTexts = {
                "FranÃ§ais": "Test your knowledge of French language and culture",
                "English": "Challenge yourself with English questions",
                "EspaÃ±ol": "Demuestra tu conocimiento del espaÃ±ol",
                "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©": "Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ø±ÙØªÙƒ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
                "Deutsch": "Teste dein Wissen Ã¼ber die deutsche Sprache",
                "Italiano": "Metti alla prova la tua conoscenza dell'italiano"
            };
            
            document.getElementById('quiz-info').textContent = 
                infoTexts[question.language] || `Answer the question in ${question.language}`;
        }

        function selectAnswer(index) {
            if (answered) return;
            
            userAnswers[currentQuestion] = index;
            
            const options = document.querySelectorAll('.answer-option');
            options.forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
        }

        function confirmAnswer() {
            if (userAnswers[currentQuestion] === undefined) {
                alert('Please select an answer!');
                return;
            }
            
            answered = true;
            const question = questions[currentQuestion];
            const options = document.querySelectorAll('.answer-option');
            
            options.forEach((opt, i) => {
                opt.style.pointerEvents = 'none';
                if (i === question.correct) {
                    opt.classList.add('correct');
                } else if (i === userAnswers[currentQuestion]) {
                    opt.classList.add('wrong');
                }
            });
            
            if (userAnswers[currentQuestion] === question.correct) {
                score += 10;
            } else {
                score -= 5;
            }
            
            document.getElementById('confirm-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-flex';
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        async function showResults() {
            if (score < 0) score = 0;
            
            let correctAnswers = 0;
            for (let i = 0; i < questions.length; i++) {
                if (userAnswers[i] === questions[i].correct) {
                    correctAnswers++;
                }
            }
            const accuracy = Math.round((correctAnswers / questions.length) * 100);
            
            document.getElementById('final-score').textContent = score + ' Pts';
            
            await saveScore(accuracy);
            
            showScreen('results-screen');
        }

        async function saveScore(accuracy) {
            const scoreData = {
                name: participantName,
                score: score,
                accuracy: accuracy,
                date: new Date().toISOString()
            };
            
            try {
                if (window.storage && typeof window.storage.set === 'function') {
                    const uniqueKey = `quiz-score-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    const result = await window.storage.set(
                        uniqueKey,
                        JSON.stringify(scoreData),
                        true
                    );
                    
                    if (result) {
                        console.log('Score sauvegardÃ© dans le leaderboard global');
                        return;
                    }
                }
            } catch (error) {
                console.error('Erreur de sauvegarde:', error);
            }
            
            localScores.push(scoreData);
            console.log('Score sauvegardÃ© localement (non partagÃ©)');
        }

        async function showLeaderboard() {
            let scores = [];
            let isGlobalLeaderboard = false;
            
            try {
                if (window.storage && typeof window.storage.list === 'function') {
                    const result = await window.storage.list('quiz-score-', true);
                    
                    if (result && result.keys && result.keys.length > 0) {
                        console.log(`${result.keys.length} scores trouvÃ©s dans le leaderboard global`);
                        
                        for (const key of result.keys) {
                            try {
                                const data = await window.storage.get(key, true);
                                if (data && data.value) {
                                    scores.push(JSON.parse(data.value));
                                }
                            } catch (e) {
                                console.error('Erreur lecture score:', e);
                            }
                        }
                        isGlobalLeaderboard = true;
                    }
                }
            } catch (error) {
                console.error('Erreur accÃ¨s au leaderboard global:', error);
            }
            
            if (!isGlobalLeaderboard && localScores.length > 0) {
                scores = [...localScores];
                console.log('Affichage du leaderboard local uniquement');
            }
            
            scores.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return b.accuracy - a.accuracy;
            });
            
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            
            const infoBox = document.querySelector('#leaderboard-screen .info-box');
            if (isGlobalLeaderboard) {
                infoBox.textContent = `ðŸŒ Global Leaderboard - ${scores.length} participants`;
            } else {
                infoBox.textContent = 'Leaderboard (Session locale uniquement)';
            }
            
            if (scores.length > 0) {
                scores.slice(0, 20).forEach((scoreData, index) => {
                    const row = tbody.insertRow();
                    
                    const isCurrentPlayer = scoreData.name === participantName && 
                                           Math.abs(scoreData.score - score) < 1;
                    if (isCurrentPlayer) {
                        row.style.background = 'rgba(213, 191, 134, 0.3)';
                        row.style.border = '2px solid #D5BF86';
                    }
                    
                    let rankDisplay = `#${index + 1}`;
                    if (index === 0) rankDisplay = 'ðŸ¥‡ #1';
                    else if (index === 1) rankDisplay = 'ðŸ¥ˆ #2';
                    else if (index === 2) rankDisplay = 'ðŸ¥‰ #3';
                    
                    row.innerHTML = `
                        <td class="rank">${rankDisplay}</td>
                        <td>${scoreData.name}${isCurrentPlayer ? ' (You)' : ''}</td>
                        <td>${scoreData.accuracy}%</td>
                        <td><strong>${scoreData.score} pts</strong></td>
                    `;
                });
            } else {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px;">
                        No scores yet. Be the first to play!
                    </td>
                `;
            }
            
            showScreen('leaderboard-screen');
        }

        function resetQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            participantName = '';
            questions = [];
            document.getElementById('participant-name').value = '';
            showScreen('welcome-screen');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>